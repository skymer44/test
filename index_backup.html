<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programme Musical 2026</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Programme Musical 2026</h1>
        </div>
    </header>

    <!-- Navigation par onglets -->
    <nav class="tab-navigation">
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="programmes">📚 Programmes Musicaux</button>
                <button class="tab-button" data-tab="financement">💰 Financement</button>
            </div>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Rechercher une pièce, un compositeur..." class="search-input">
            </div>
        </div>
    </nav>

    <main>
        <!-- Section Programmes -->
        <div id="programmes" class="tab-content active">
        <!-- Ma région virtuose -->
        <section id="ma-region-virtuose" class="concert-section">
            <div class="section-header">
                <h2>Ma région virtuose</h2>
                <button class="pdf-download-btn" data-section="ma-region-virtuose" title="Télécharger ce programme en PDF">
                    📄 Télécharger PDF
                </button>
            </div>
            <div class="pieces-grid">
                <div class="piece-card">
                    <h3>Ammerland</h3>
                    <p><strong>Compositeur:</strong> Jacob de Haan</p>
                    <p><strong>Durée:</strong> 03:10</p>
                    <p><strong>Info:</strong> Très interessant pour le son mais assez chère</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=y5GQ0we6dOc" target="_blank">🎵 Audio</a>
                        <a href="https://www.laflutedepan.com/partition/10102812/de-haan-jacob-ammerland-concert-bandharmonie.html" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Music from How To Train Your Dragon</h3>
                    <p><strong>Compositeur:</strong> John Powell/arr. Sean O'Loughlin</p>
                    <p><strong>Durée:</strong> 04:50</p>
                    <p><strong>Info:</strong> Marche très bien, joviale</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=FfOuif5v554&list=RDFfOuif5v554&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.sheetmusicdirect.com/en-US/Search.aspx?query=Music from How To Train Your Dragon - 02501568&utm_source=youtube&utm_medium=band-orch-scoreplay" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>The Lion King</h3>
                    <p><strong>Compositeur:</strong> John Higgins</p>
                    <p><strong>Durée:</strong> 08:40</p>
                    <p><strong>Info:</strong> Super pièce</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=WEEDErl0wlI&list=RDWEEDErl0wlI&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.halleonard.com/product/viewproduct.action?itemid=20523032&subsiteid=1" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Selections from The Nightmare Before Christmas</h3>
                    <p><strong>Compositeur:</strong> Elfman/arr. Brown</p>
                    <p><strong>Durée:</strong> 05:12</p>
                    <p><strong>Info:</strong> Excellent</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=294MV8S7dU4" target="_blank">🎵 Audio</a>
                        <a href="https://www.youtube.com/watch?v=SAfmjPwxspI&list=RDSAfmjPwxspI&start_radio=1" target="_blank">🎬 Original</a>
                        <a href="https://www.sheetmusicdirect.com/en-US/Search.aspx?query=Selections from Nightmare Before Christmas – Michael Brown&utm_source=youtube&utm_medium=band-orch-scoreplay" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Allegretto from Symphony No. 7</h3>
                    <p><strong>Compositeur:</strong> Beethoven/arr. Longfield</p>
                    <p><strong>Durée:</strong> 03:00</p>
                    <p><strong>Info:</strong> Bien arrangée, bien gérer la répartition</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=-McQCz0vWc8&list=RD-McQCz0vWc8&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.youtube.com/watch?v=xaYWy3eHtCM&list=RDxaYWy3eHtCM&start_radio=1" target="_blank">🎬 Original</a>
                        <a href="https://www.sheetmusicdirect.com/en-US/se/ID_No/347710/Product.aspx" target="_blank">🛒 Achat</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Concert Eric Aubier -->
        <section id="concert-eric-aubier" class="concert-section">
            <div class="section-header">
                <h2>Concert du 11 d'avril avec Eric Aubier</h2>
                <button class="pdf-download-btn" data-section="concert-eric-aubier" title="Télécharger ce programme en PDF">
                    📄 Télécharger PDF
                </button>
            </div>
            <div class="pieces-grid">
                <div class="piece-card">
                    <h3>Aratunian</h3>
                    <p><strong>Compositeur:</strong> ARUTIUNIAN Alexander / arr. SCHYNS José</p>
                    <p><strong>Durée:</strong> 16:00</p>
                    <p><strong>Info:</strong> Pièce complète mais pas évident / vérifier le niveau</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=Uqr-eVJo55E&list=RDUqr-eVJo55E&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.youtube.com/watch?v=EY0A20C9HOY&list=RDEY0A20C9HOY&start_radio=1" target="_blank">🎬 Original</a>
                        <a href="https://www.hafabramusic.com/product-score/952/en" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Napoli</h3>
                    <p><strong>Compositeur:</strong> Hermann Bellstedt / arr. Donald Hunsberger</p>
                    <p><strong>Durée:</strong> 6:00</p>
                    <p><strong>Info:</strong> Impressionnant et élégant</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=I2sj0poJF-o&t=4s" target="_blank">🎵 Audio</a>
                        <a href="https://www.youtube.com/watch?v=elo0SPMo6qg&list=RDelo0SPMo6qg&start_radio=1" target="_blank">🎬 Original</a>
                        <a href="https://www.alfred.com/napoli/p/00-38388/?utm_source=YouTube&utm_medium=social&utm_campaign=Score_Sound&utm_content=ConcertBand" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Carnaval de Venise</h3>
                    <p><strong>Compositeur:</strong> J.B. Arban/Hunsberger</p>
                    <p><strong>Durée:</strong> 08:25</p>
                    <p><strong>Info:</strong> Très grand public / show</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=Ia6c6uIIb_Q" target="_blank">🎵 Audio</a>
                        <a href="https://www.youtube.com/watch?v=R0MYe-qAG4Y&list=RDR0MYe-qAG4Y&start_radio=1" target="_blank">🎬 Original</a>
                        <a href="https://www.jwpepper.com/carnival-of-venice-2308518/p?srsltid=AfmBOooSWRItKPWV_NWn28unjPOefT0YfzJ4patsTc9t45N_f_c1EynY" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>La Virgen de la Macarena</h3>
                    <p><strong>Compositeur:</strong> Arrangement David Marlatt</p>
                    <p><strong>Durée:</strong> 03:00</p>
                    <p><strong>Info:</strong> Pas encore convaincu</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=jqwxZKDWBOo&list=RDjqwxZKDWBOo&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.windmusicsales.com/view-listen/Traditional Spanish/LaVirgendelaMacarena/CB28121-CB3" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>The Mandalorian</h3>
                    <p><strong>Compositeur:</strong> Ludwig Göransson/arr. Paul Murtha</p>
                    <p><strong>Durée:</strong> 02:34</p>
                    <p><strong>Info:</strong> Pièce courte</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=nkKBElbZZ8o&list=RDnkKBElbZZ8o&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.sheetmusicdirect.com/en-US/Search.aspx?query=The Mandalorian – Murtha – 04006608&utm_source=youtube&utm_medium=band-orch-scoreplay" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Eldorado</h3>
                    <p><strong>Compositeur:</strong> Thierry Deleruyelle</p>
                    <p><strong>Durée:</strong> 10:20</p>
                    <p><strong>Info:</strong> Challenge accessible</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=skTOXVCcER4&list=RDskTOXVCcER4&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.partitions-musicales.net/Harmonie/Eldorado-nr-1.html" target="_blank">🛒 Achat</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fête de la Musique -->
        <section id="fete-musique" class="concert-section">
            <div class="section-header">
                <h2>Programme fête de la musique</h2>
                <button class="pdf-download-btn" data-section="fete-musique" title="Télécharger ce programme en PDF">
                    📄 Télécharger PDF
                </button>
            </div>
            <div class="pieces-grid">
                <div class="piece-card">
                    <h3>Begegnung</h3>
                    <p><strong>Compositeur:</strong> Kurt Gäble</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=-oVXca78OVc" target="_blank">🎵 Audio</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Libertango</h3>
                    <p><strong>Compositeur:</strong> Astor Piazzola / arr. Tony Cheseaux</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=eJlUJYbUxZo" target="_blank">🎵 Audio</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Autres pièces -->
        <section id="autres-pieces" class="concert-section">
            <div class="section-header">
                <h2>Pièces qui n'ont pas trouvé leur concert</h2>
                <button class="pdf-download-btn" data-section="autres-pieces" title="Télécharger ce programme en PDF">
                    📄 Télécharger PDF
                </button>
            </div>
            <div class="pieces-grid">
                <div class="piece-card">
                    <h3>Oregon</h3>
                    <p><strong>Compositeur:</strong> Jacob de Haan</p>
                    <p><strong>Durée:</strong> 09:09</p>
                    <p><strong>Info:</strong> Vérifier le niveau et l'intérêt</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=to3gePlszMY&list=RDto3gePlszMY&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.rundel.de/fr/artikel/oregon/DH890139" target="_blank">🛒 Achat</a>
                    </div>
                </div>

                <div class="piece-card">
                    <h3>Danse Bacchanale Samson et Dalila, Op. 47</h3>
                    <p><strong>Compositeur:</strong> Camille Saint-Saëns / arr. L. Steiger</p>
                    <p><strong>Durée:</strong> 07:20</p>
                    <p><strong>Info:</strong> La pièce est peut-être trop dure.</p>
                    <div class="links">
                        <a href="https://www.youtube.com/watch?v=1VuTNuH6Oio&list=RD1VuTNuH6Oio&start_radio=1" target="_blank">🎵 Audio</a>
                        <a href="https://www.hebu-music.com/en/article/camille-saint-saens/neil-a-kjos-music-company/danse-bacchanale-samson-and-delilah.150183/" target="_blank">🛒 Achat</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sections en attente / à développer -->
        <section id="conservatoire-60ans" class="concert-section empty-section">
            <h2>Insertion dans les 60 ans du Conservatoire</h2>
            <div class="empty-content">
                <p>🚧 Section en cours de développement</p>
                <p>Les détails de cette programmation seront bientôt disponibles.</p>
            </div>
        </section>

        <section id="retour-karaoke" class="concert-section empty-section">
            <h2>Retour Karaoké</h2>
            <div class="empty-content">
                <p>🚧 Section en cours de développement</p>
                <p>Les détails de cette programmation seront bientôt disponibles.</p>
            </div>
        </section>

        <section id="loto" class="concert-section empty-section">
            <h2>Loto</h2>
            <div class="empty-content">
                <p>🚧 Section en cours de développement</p>
                <p>Les détails de cette programmation seront bientôt disponibles.</p>
            </div>
        </section>

        <section id="pieces-ajout-sans-direction" class="concert-section empty-section">
            <h2>Pièces d'ajout sans direction</h2>
            <div class="empty-content">
                <p>🚧 Section en cours de développement</p>
                <p>Les détails de cette programmation seront bientôt disponibles.</p>
            </div>
        </section>

        </div> <!-- Fin de la section programmes -->

        <!-- Section Financement -->
        <div id="financement" class="tab-content">
        <section class="funding-section">
            <h2>Informations sur les moyens de financement du projet avec Eric Aubier</h2>
            <div class="funding-table">
                <table>
                    <thead>
                        <tr>
                            <th>Dispositif</th>
                            <th>Dépôt possible avant 11 avr. 26</th>
                            <th>Montant indicatif</th>
                            <th>Probabilité</th>
                            <th>Master-class</th>
                            <th>Conditions clés</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>DRAC PDL – EAC / Culture & Ruralité</td>
                            <td>sept. → 15 nov. 25</td>
                            <td>1 500 → 6 000 €</td>
                            <td>★★/★★★</td>
                            <td>Obligatoire</td>
                            <td>Action éducative rurale, dossier DS, budget argumenté</td>
                        </tr>
                        <tr>
                            <td>Plan Fanfare</td>
                            <td>janv. → mi-mars 26</td>
                            <td>2 000 → 4 000 €</td>
                            <td>★ + points</td>
                            <td></td>
                            <td>Orchestre d'harmonie amateur, publics intergénérationnels</td>
                        </tr>
                        <tr>
                            <td>Département 44 – Diffusion</td>
                            <td>nov. 25 ou mars 26</td>
                            <td>25 % (commune) à 30 % (asso) du cachet HT (plafond 4 000 €)</td>
                            <td>★★★ + points</td>
                            <td></td>
                            <td>Association ou commune < 15 k hab., 1-3 représentations</td>
                        </tr>
                        <tr>
                            <td>Projet culturel de territoire (CDC)</td>
                            <td>sept. → oct. 25</td>
                            <td>2 000 → 4 000 €</td>
                            <td>★★ + points</td>
                            <td></td>
                            <td>Impact inter-communal, partenariat écoles</td>
                        </tr>
                        <tr>
                            <td>FDVA 2 – Nouveaux projets</td>
                            <td>15 janv. → 12 mars 26</td>
                            <td>500 → 1 500 €</td>
                            <td>★★ + points</td>
                            <td></td>
                            <td>Formation des bénévoles, budget < 15 k €</td>
                        </tr>
                        <tr>
                            <td>Pass Culture – part collective</td>
                            <td>Offre à créer juil. 25</td>
                            <td>25/30 € par élève (≈ 1 500-2 000 €)</td>
                            <td>★★★*</td>
                            <td>Obligatoire</td>
                            <td>Réservation ADAGE par les profs, facture sur passculture.pro</td>
                        </tr>
                        <tr>
                            <td>SACEM – Soutien ensembles amateurs</td>
                            <td>continu (4 sem. avant date)</td>
                            <td>20-30 % du cachet pro</td>
                            <td>★★ + points</td>
                            <td></td>
                            <td>Programme déclaré, avis délégué régional</td>
                        </tr>
                        <tr>
                            <td>Mécénat entreprise</td>
                            <td>continu</td>
                            <td>déductible à 60 % CGI 238 bis</td>
                            <td>— neutre</td>
                            <td></td>
                            <td>Contreparties ≤ 25 % de la valeur du don</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        </div> <!-- Fin de la section financement -->

    </main>

            <section id="big-spender">
            <h2>Big Spender</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="youll-be-back">
            <h2>You’ll be back</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="skyfall">
            <h2>Skyfall</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="soundtrack-highlights-from-the-hunger-games">
            <h2>Soundtrack Highlights from the Hunger Games</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="suite-from-symphonie-fantastique">
            <h2>Suite from Symphonie Fantastique</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="tableaux-dune-exposition">
            <h2>Tableaux d’une exposition</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="lhymne-a-lamour">
            <h2>L’hymne à l’amour</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="mambo-extrait-west-side-story">
            <h2>Mambo (extrait West side Story)</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="rhapsody-in-blue">
            <h2>Rhapsody In Blue</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="waltz-no-2">
            <h2>Waltz No. 2</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="west-side-story-a-medley">
            <h2>West Side Story (A Medley)</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="epic-gaming-themes">
            <h2>Epic Gaming Themes</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="bamboleo">
            <h2>Bamboleo</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="music-from-carmen">
            <h2>Music from Carmen</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="night-on-bald-mountain">
            <h2>Night On Bald Mountain</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="danse-des-sauvages">
            <h2>Danse des Sauvages</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="three-klezmer-miniatures">
            <h2>Three Klezmer Miniatures</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="lac-des-cygnes">
            <h2>Lac des cygnes</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

            <section id="pirates-of-the-caribbean-medley">
            <h2>Pirates of the Caribbean Medley</h2>
            <div class="pieces-grid">
                
            </div>
        </section>

    </main>

    <!-- Modale vidéo YouTube -->
    <div id="video-modal" class="video-modal">
        <div class="video-modal-wrapper">
            <div class="video-controls">
                <button id="audio-mode-btn" class="control-btn" title="Mode audio uniquement">🎧</button>
                <button id="close-modal-btn" class="control-btn" title="Fermer">✕</button>
            </div>
            <div class="video-modal-content">
                <div class="video-container">
                    <iframe id="youtube-player" 
                            width="100%" 
                            height="100%" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Mini-lecteur audio en bas -->
    <div id="audio-player" class="audio-player">
        <div class="audio-player-content">
            <div class="audio-info">
                <span id="audio-title">Titre de la pièce</span>
            </div>
            <div class="audio-controls">
                <button id="show-video-btn" class="audio-control-btn" title="Afficher la vidéo">▶</button>
                <button id="stop-audio-btn" class="audio-control-btn" title="Arrêter">⏹</button>
            </div>
        </div>
    </div>

    <!-- Bibliothèque jsPDF pour la génération de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Script minimal pour les fonctionnalités de base -->
    <script>
        // Attendre que le DOM soit chargé
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Programme Musical 2026 - Chargement terminé!');
            
            // Initialiser les fonctionnalités
            initTabs();
            initVideoModal();
            addSearchFunctionality();
            initPDFGeneration();
            
            console.log('✅ Site web prêt!');
        });

        // Fonction pour générer un PDF (version clean - prioritaire)
        function generatePDFClean(sectionId) {
            console.log('🔄 Début de génération PDF pour:', sectionId);
            
            const section = document.getElementById(sectionId);
            if (!section) {
                console.error('❌ Section non trouvée:', sectionId);
                alert('Erreur: Section non trouvée');
                return;
            }

            // Vérifier les différentes façons dont jsPDF peut être chargé
            let jsPDFConstructor = null;
            
            if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
                jsPDFConstructor = window.jspdf.jsPDF;
                console.log('✅ jsPDF trouvé via window.jspdf.jsPDF');
            } else if (typeof jsPDF !== 'undefined') {
                jsPDFConstructor = jsPDF;
                console.log('✅ jsPDF trouvé via jsPDF global');
            } else if (typeof window.jsPDF !== 'undefined') {
                jsPDFConstructor = window.jsPDF;
                console.log('✅ jsPDF trouvé via window.jsPDF');
            } else {
                console.error('❌ jsPDF non disponible');
                alert('Erreur: jsPDF non disponible. Veuillez recharger la page.');
                return;
            }

            try {
                console.log('🔄 Création du document PDF...');
                // Créer une nouvelle instance jsPDF
                const doc = new jsPDFConstructor();
                
                // Configuration de base
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                let currentY = margin;
                
                // Récupérer le titre de la section
                const titleElement = section.querySelector('h2');
                const sectionTitle = titleElement ? titleElement.textContent.trim() : 'Programme Musical';
                
                // En-tête du document
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Programme Musical 2026', pageWidth / 2, currentY, { align: 'center' });
                currentY += 15;
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(sectionTitle, pageWidth / 2, currentY, { align: 'center' });
                currentY += 10;
                
                // Ligne de séparation
                doc.setLineWidth(0.5);
                doc.line(margin, currentY, pageWidth - margin, currentY);
                currentY += 15;
                
                // Date de génération
                doc.setFontSize(9);
                doc.setFont(undefined, 'italic');
                const currentDate = new Date().toLocaleDateString('fr-FR');
                const currentTime = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                doc.text(`Document généré le ${currentDate} à ${currentTime}`, pageWidth / 2, currentY, { align: 'center' });
                currentY += 20;
                
                // Récupérer toutes les pièces de la section
                const pieces = section.querySelectorAll('.piece-card');
                const realPieces = Array.from(pieces).filter(piece => {
                    const title = piece.querySelector('h3');
                    return title && !piece.textContent.includes('Section en cours');
                });
                
                if (realPieces.length === 0) {
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'italic');
                    doc.text('Cette section ne contient pas encore de pièces musicales.', pageWidth / 2, currentY, { align: 'center' });
                } else {
                    // Traiter chaque pièce
                    realPieces.forEach((piece, index) => {
                        const title = piece.querySelector('h3')?.textContent.trim() || 'Titre non spécifié';
                        
                        // Chercher le compositeur
                        const composerElement = Array.from(piece.querySelectorAll('p')).find(p => 
                            p.textContent.includes('Compositeur:')
                        );
                        const composer = composerElement ? 
                            composerElement.textContent.replace('Compositeur:', '').trim() : 
                            'Compositeur non spécifié';
                        
                        // Chercher la durée
                        const durationElement = Array.from(piece.querySelectorAll('p')).find(p => 
                            p.textContent.includes('Durée:')
                        );
                        const duration = durationElement ? 
                            durationElement.textContent.replace('Durée:', '').trim() : '';
                        
                        // Ajouter un espacement entre les pièces
                        if (index > 0) {
                            currentY += 8;
                        }
                        
                        // Vérifier si on a besoin d'une nouvelle page
                        if (currentY > pageHeight - 40) {
                            doc.addPage();
                            currentY = margin;
                        }
                        
                        // Titre de la pièce
                        doc.setFontSize(13);
                        doc.setFont(undefined, 'bold');
                        doc.text(`${index + 1}. ${title}`, margin, currentY);
                        currentY += 6;
                        
                        // Compositeur
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.text(`Compositeur : ${composer}`, margin + 10, currentY);
                        currentY += 5;
                        
                        // Durée (si disponible)
                        if (duration) {
                            doc.text(`Durée : ${duration}`, margin + 10, currentY);
                            currentY += 5;
                        }
                    });
                }
                
                // Pied de page
                const footerY = pageHeight - 15;
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.text('Programme Musical 2026', pageWidth / 2, footerY, { align: 'center' });
                
                // Générer le nom de fichier
                const fileName = `Programme_${sectionTitle.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                
                // Télécharger le PDF
                console.log('💾 Téléchargement du PDF:', fileName);
                doc.save(fileName);
                
                console.log(`✅ PDF généré avec succès: ${fileName}`);
            } catch (error) {
                console.error('❌ Erreur lors de la génération PDF:', error);
                alert('Erreur lors de la génération du PDF');
            }
        }

        // Fonction d'initialisation des boutons PDF
        function initPDFGeneration() {
            console.log('🔄 Initialisation des boutons PDF...');
            
            // Vérifier que jsPDF est disponible
            function checkJsPDF() {
                return (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) ||
                       (typeof jsPDF !== 'undefined') ||
                       (typeof window.jsPDF !== 'undefined');
            }
            
            // Fonction pour configurer les boutons PDF
            function setupPDFButtons() {
                const buttons = document.querySelectorAll('.pdf-download-btn');
                console.log(`🔄 Configuration de ${buttons.length} boutons PDF`);
                
                buttons.forEach((button, index) => {
                    const sectionId = button.getAttribute('data-section');
                    console.log(`   - Bouton ${index + 1}: section "${sectionId}"`);
                    
                    // Supprimer les anciens listeners
                    button.onclick = null;
                    
                    // Ajouter le nouveau listener
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log(`🖱️ Clic sur bouton PDF pour section: ${sectionId}`);
                        generatePDFClean(sectionId);
                    });
                    
                    // S'assurer que le bouton est activé
                    button.disabled = false;
                    button.style.opacity = '1';
                });
                
                console.log('✅ Boutons PDF configurés avec succès');
            }
            
            // Vérifier immédiatement
            if (checkJsPDF()) {
                console.log('✅ jsPDF détecté immédiatement');
                setupPDFButtons();
            } else {
                console.log('⏳ En attente du chargement de jsPDF...');
                
                // Attendre un peu plus longtemps pour le chargement
                let attempts = 0;
                const maxAttempts = 10;
                
                const checkInterval = setInterval(() => {
                    attempts++;
                    console.log(`⏳ Tentative ${attempts}/${maxAttempts} de détection jsPDF...`);
                    
                    if (checkJsPDF()) {
                        console.log('✅ jsPDF détecté après attente');
                        clearInterval(checkInterval);
                        setupPDFButtons();
                    } else if (attempts >= maxAttempts) {
                        console.error('❌ jsPDF non disponible après plusieurs tentatives');
                        clearInterval(checkInterval);
                        
                        // Désactiver les boutons PDF
                        document.querySelectorAll('.pdf-download-btn').forEach(button => {
                            button.disabled = true;
                            button.textContent = '❌ PDF indisponible';
                            button.style.opacity = '0.5';
                        });
                        
                        alert('Erreur: Impossible de charger jsPDF. Les fonctions PDF ne sont pas disponibles.');
                    }
                }, 500); // Vérifier toutes les 500ms
            }
        }
        
        // Écraser la fonction generatePDF du script.js pour assurer la compatibilité
        window.generatePDF = generatePDFClean;
        console.log('🔄 Fonction generatePDF redéfinie pour la version clean');
    </script>
    
    <!-- AUCUN SCRIPT D'ANALYSE AUTOMATIQUE -->
    <script src="script-clean-v2.js"></script>
</body>
</html>
