/**
 * DONNÉES DE RÉFÉRENCE - Programme Musical 2026
 * 
 * Ce fichier contient la structure de référence du programme musical
 * utilisée pour détecter les changements dans les nouveaux documents.
 * 
 * Généré automatiquement le 2025-07-05 à partir du document de référence PDF.
 */

window.BASELINE_DATA = {
    metadata: {
        version: "1.0.0",
        lastUpdate: "2025-07-05T11:08:08.649Z",
        sourceDocument: "Programme 2026 20cfcf9e3abc80d6ae94ea9b68a63358.pdf",
        totalConcerts: 7,
        totalPieces: 17
    },
    
    concerts: [
        {
            id: "ma-region-virtuose",
            title: "Ma région virtuose",
            duration: "25 minutes",
            pieces: [
                {
                    title: "Ammerland",
                    composer: "Jacob de Haan",
                    duration: "03:10",
                    info: "Très interessant pour le son mais assez chère",
                    links: {
                        audio: "https://www.youtube.com/watch?v=y5GQ0we6dOc",
                        purchase: "https://www.laflutedepan.com/partition/10102812/de-haan-jacob-ammerland-concert-bandharmonie.html"
                    }
                },
                {
                    title: "Music from How To Train Your Dragon",
                    composer: "John Powell/arr. Sean O'Loughlin",
                    duration: "04:50",
                    info: "Marche très bien, joviale",
                    links: {
                        audio: "https://www.youtube.com/watch?v=FfOuif5v554&list=RDFfOuif5v554&start_radio=1",
                        purchase: "https://www.sheetmusicdirect.com/en-US/Search.aspx?query=Music from How To Train Your Dragon - 02501568&utm_source=youtube&utm_medium=band-orch-scoreplay"
                    }
                },
                {
                    title: "The Lion King",
                    composer: "John Higgins",
                    duration: "08:40",
                    info: "Super pièce",
                    links: {
                        audio: "https://www.youtube.com/watch?v=WEEDErl0wlI&list=RDWEEDErl0wlI&start_radio=1",
                        purchase: "https://www.halleonard.com/product/viewproduct.action?itemid=20523032&subsiteid=1"
                    }
                },
                {
                    title: "Selections from The Nightmare Before Christmas",
                    composer: "Elfman/arr. Brown",
                    duration: "05:12",
                    info: "Excellent",
                    links: {
                        audio: "https://www.youtube.com/watch?v=294MV8S7dU4",
                        original: "https://www.youtube.com/watch?v=SAfmjPwxspI&list=RDSAfmjPwxspI&start_radio=1",
                        purchase: "https://www.sheetmusicdirect.com/en-US/Search.aspx?query=Selections from Nightmare Before Christmas – Michael Brown&utm_source=youtube&utm_medium=band-orch-scoreplay"
                    }
                },
                {
                    title: "Allegretto from Symphony No. 7",
                    composer: "Beethoven/arr. Longfield",
                    duration: "03:00",
                    info: "Bien arrangée, bien gérer la répartition",
                    links: {
                        audio: "https://www.youtube.com/watch?v=-McQCz0vWc8&list=RD-McQCz0vWc8&start_radio=1",
                        original: "https://www.youtube.com/watch?v=xaYWy3eHtCM&list=RDxaYWy3eHtCM&start_radio=1",
                        purchase: "https://www.sheetmusicdirect.com/en-US/se/ID_No/347710/Product.aspx"
                    }
                }
            ]
        },
        {
            id: "concert-eric-aubier",
            title: "Concert du 11 avril avec Eric Aubier",
            duration: "1h",
            pieces: [
                {
                    title: "Aratunian",
                    composer: "ARUTIUNIAN Alexander / arr. SCHYNS José",
                    duration: "16:00",
                    info: "Pièce complète mais pas évident / vérifier le niveau",
                    links: {
                        audio: "https://www.youtube.com/watch?v=Uqr-eVJo55E&list=RDUqr-eVJo55E&start_radio=1",
                        original: "https://www.youtube.com/watch?v=EY0A20C9HOY&list=RDEY0A20C9HOY&start_radio=1",
                        purchase: "https://www.hafabramusic.com/product-score/952/en"
                    }
                },
                {
                    title: "Napoli",
                    composer: "Hermann Bellstedt / arr. Donald Hunsberger",
                    duration: "6:00",
                    info: "Impressionnant et élégant",
                    links: {
                        audio: "https://www.youtube.com/watch?v=I2sj0poJF-o&t=4s",
                        original: "https://www.youtube.com/watch?v=elo0SPMo6qg&list=RDelo0SPMo6qg&start_radio=1",
                        purchase: "https://www.alfred.com/napoli/p/00-38388/?utm_source=YouTube&utm_medium=social&utm_campaign=Score_Sound&utm_content=ConcertBand"
                    }
                },
                {
                    title: "Carnaval de Venise",
                    composer: "J.B. Arban/Hunsberger",
                    duration: "08:25",
                    info: "Très grand public / show",
                    links: {
                        audio: "https://www.youtube.com/watch?v=Ia6c6uIIb_Q",
                        original: "https://www.youtube.com/watch?v=R0MYe-qAG4Y&list=RDR0MYe-qAG4Y&start_radio=1",
                        purchase: "https://www.jwpepper.com/carnival-of-venice-2308518/p?srsltid=AfmBOooSWRItKPWV_NWn28unjPOefT0YfzJ4patsTc9t45N_f_c1EynY"
                    }
                },
                {
                    title: "La Virgen de la Macarena",
                    composer: "Arrangement David Marlatt",
                    duration: "03:00",
                    info: "Pas encore convaincu",
                    links: {
                        audio: "https://www.youtube.com/watch?v=jqwxZKDWBOo&list=RDjqwxZKDWBOo&start_radio=1",
                        purchase: "https://www.windmusicsales.com/view-listen/Traditional Spanish/LaVirgendelaMacarena/CB28121-CB3"
                    }
                },
                {
                    title: "The Mandalorian",
                    composer: "Ludwig Göransson/arr. Paul Murtha",
                    duration: "02:34",
                    info: "Pièce courte",
                    links: {
                        audio: "https://www.youtube.com/watch?v=nkKBElbZZ8o&list=RDnkKBElbZZ8o&start_radio=1",
                        purchase: "https://www.sheetmusicdirect.com/en-US/Search.aspx?query=The Mandalorian – Murtha – 04006608&utm_source=youtube&utm_medium=band-orch-scoreplay"
                    }
                },
                {
                    title: "Eldorado",
                    composer: "Thierry Deleruyelle",
                    duration: "10:20",
                    info: "Challenge accessible",
                    links: {
                        audio: "https://www.youtube.com/watch?v=skTOXVCcER4&list=RDskTOXVCcER4&start_radio=1",
                        purchase: "https://www.partitions-musicales.net/Harmonie/Eldorado-nr-1.html"
                    }
                }
            ]
        },
        {
            id: "fete-musique",
            title: "Programme fête de la musique",
            duration: "35-40 minutes",
            pieces: [
                {
                    title: "Begegnung",
                    composer: "Kurt Gäble",
                    links: {
                        audio: "https://www.youtube.com/watch?v=-oVXca78OVc"
                    }
                },
                {
                    title: "Libertango",
                    composer: "Astor Piazzola / arr. Tony Cheseaux",
                    links: {
                        audio: "https://www.youtube.com/watch?v=eJlUJYbUxZo"
                    }
                }
            ]
        },
        {
            id: "autres-pieces",
            title: "Pièces qui n'ont pas trouvé leur concert",
            pieces: [
                {
                    title: "Oregon",
                    composer: "Jacob de Haan",
                    duration: "09:09",
                    info: "Vérifier le niveau et l'intérêt",
                    links: {
                        audio: "https://www.youtube.com/watch?v=to3gePlszMY&list=RDto3gePlszMY&start_radio=1",
                        purchase: "https://www.rundel.de/fr/artikel/oregon/DH890139"
                    }
                },
                {
                    title: "Danse Bacchanale Samson et Dalila, Op. 47",
                    composer: "Camille Saint-Saëns / arr. L. Steiger",
                    duration: "07:20",
                    info: "La pièce est peut-être trop dure.",
                    links: {
                        audio: "https://www.youtube.com/watch?v=1VuTNuH6Oio&list=RD1VuTNuH6Oio&start_radio=1",
                        purchase: "https://www.hebu-music.com/en/article/camille-saint-saens/neil-a-kjos-music-company/danse-bacchanale-samson-and-delilah.150183/"
                    }
                }
            ]
        },
        {
            id: "conservatoire-60ans",
            title: "Insertion dans les 60 ans du Conservatoire",
            status: "à déterminer",
            isEmpty: true
        },
        {
            id: "retour-karaoke",
            title: "Retour Karaoké",
            isEmpty: true
        },
        {
            id: "loto",
            title: "Loto",
            isEmpty: true
        },
        {
            id: "pieces-ajout-sans-direction",
            title: "Pièces d'ajout sans direction",
            isEmpty: true
        }
    ],
    
    financing: {
        title: "Informations sur les moyens de financement du projet avec Eric Aubier",
        schemes: [
            {
                name: "DRAC PDL – EAC / Culture & Ruralité",
                deadline: "sept. → 15 nov. 25",
                amount: "1 500 → 6 000 €",
                probability: "★★/★★★",
                masterclass: "Obligatoire",
                conditions: "Action éducative rurale, dossier DS, budget argumenté"
            },
            {
                name: "Plan Fanfare",
                deadline: "janv. → mi-mars 26",
                amount: "2 000 → 4 000 €",
                probability: "★ + points",
                masterclass: "",
                conditions: "Orchestre d'harmonie amateur, publics intergénérationnels"
            },
            {
                name: "Département 44 – Diffusion",
                deadline: "nov. 25 ou mars 26",
                amount: "25 % (commune) à 30 % (asso) du cachet HT (plafond 4 000 €)",
                probability: "★★★ + points",
                masterclass: "",
                conditions: "Association ou commune < 15 k hab., 1-3 représentations"
            },
            {
                name: "Projet culturel de territoire (CDC)",
                deadline: "sept. → oct. 25",
                amount: "2 000 → 4 000 €",
                probability: "★★ + points",
                masterclass: "",
                conditions: "Impact inter-communal, partenariat écoles"
            },
            {
                name: "FDVA 2 – Nouveaux projets",
                deadline: "15 janv. → 12 mars 26",
                amount: "500 → 1 500 €",
                probability: "★★ + points",
                masterclass: "",
                conditions: "Formation des bénévoles, budget < 15 k €"
            },
            {
                name: "Pass Culture – part collective",
                deadline: "Offre à créer juil. 25",
                amount: "25/30 € par élève (≈ 1 500-2 000 €)",
                probability: "★★★*",
                masterclass: "Obligatoire",
                conditions: "Réservation ADAGE par les profs, facture sur passculture.pro"
            },
            {
                name: "SACEM – Soutien ensembles amateurs",
                deadline: "continu (4 sem. avant date)",
                amount: "20-30 % du cachet pro",
                probability: "★★ + points",
                masterclass: "",
                conditions: "Programme déclaré, avis délégué régional"
            },
            {
                name: "Mécénat entreprise",
                deadline: "continu",
                amount: "déductible à 60 % CGI 238 bis",
                probability: "— neutre",
                masterclass: "",
                conditions: "Contreparties ≤ 25 % de la valeur du don"
            }
        ]
    }
};

/**
 * UTILITAIRES D'ANALYSE ET DE COMPARAISON
 */

window.DocumentAnalyzer = {
    
    /**
     * Compare deux structures de données et retourne les différences
     */
    compareData: function(oldData, newData) {
        const changes = {
            concerts: {
                added: [],
                removed: [],
                modified: []
            },
            pieces: {
                added: [],
                removed: [],
                modified: []
            },
            financing: {
                modified: false,
                changes: []
            }
        };
        
        // Comparer les concerts
        const oldConcertIds = new Set(oldData.concerts.map(c => c.id));
        const newConcertIds = new Set(newData.concerts.map(c => c.id));
        
        // Concerts ajoutés
        newData.concerts.forEach(concert => {
            if (!oldConcertIds.has(concert.id)) {
                changes.concerts.added.push(concert);
            }
        });
        
        // Concerts supprimés
        oldData.concerts.forEach(concert => {
            if (!newConcertIds.has(concert.id)) {
                changes.concerts.removed.push(concert);
            }
        });
        
        // Concerts modifiés et pièces
        newData.concerts.forEach(newConcert => {
            const oldConcert = oldData.concerts.find(c => c.id === newConcert.id);
            if (oldConcert) {
                const concertChanges = this.compareConcert(oldConcert, newConcert);
                if (concertChanges.hasChanges) {
                    changes.concerts.modified.push({
                        id: newConcert.id,
                        title: newConcert.title,
                        changes: concertChanges
                    });
                }
                
                // Ajouter les changements de pièces
                changes.pieces.added.push(...concertChanges.pieces.added);
                changes.pieces.removed.push(...concertChanges.pieces.removed);
                changes.pieces.modified.push(...concertChanges.pieces.modified);
            }
        });
        
        return changes;
    },
    
    /**
     * Compare deux concerts
     */
    compareConcert: function(oldConcert, newConcert) {
        const changes = {
            hasChanges: false,
            titleChanged: oldConcert.title !== newConcert.title,
            durationChanged: oldConcert.duration !== newConcert.duration,
            pieces: {
                added: [],
                removed: [],
                modified: []
            }
        };
        
        if (changes.titleChanged || changes.durationChanged) {
            changes.hasChanges = true;
        }
        
        // Comparer les pièces si elles existent
        if (oldConcert.pieces && newConcert.pieces) {
            const oldPieceTitles = new Set(oldConcert.pieces.map(p => p.title));
            const newPieceTitles = new Set(newConcert.pieces.map(p => p.title));
            
            // Pièces ajoutées
            newConcert.pieces.forEach(piece => {
                if (!oldPieceTitles.has(piece.title)) {
                    changes.pieces.added.push({
                        ...piece,
                        concertId: newConcert.id,
                        concertTitle: newConcert.title
                    });
                    changes.hasChanges = true;
                }
            });
            
            // Pièces supprimées
            oldConcert.pieces.forEach(piece => {
                if (!newPieceTitles.has(piece.title)) {
                    changes.pieces.removed.push({
                        ...piece,
                        concertId: oldConcert.id,
                        concertTitle: oldConcert.title
                    });
                    changes.hasChanges = true;
                }
            });
            
            // Pièces modifiées
            newConcert.pieces.forEach(newPiece => {
                const oldPiece = oldConcert.pieces.find(p => p.title === newPiece.title);
                if (oldPiece) {
                    const pieceChanges = this.comparePiece(oldPiece, newPiece);
                    if (pieceChanges.hasChanges) {
                        changes.pieces.modified.push({
                            title: newPiece.title,
                            concertId: newConcert.id,
                            concertTitle: newConcert.title,
                            changes: pieceChanges
                        });
                        changes.hasChanges = true;
                    }
                }
            });
        }
        
        return changes;
    },
    
    /**
     * Compare deux pièces
     */
    comparePiece: function(oldPiece, newPiece) {
        const changes = {
            hasChanges: false,
            composerChanged: oldPiece.composer !== newPiece.composer,
            durationChanged: oldPiece.duration !== newPiece.duration,
            infoChanged: oldPiece.info !== newPiece.info,
            linksChanged: JSON.stringify(oldPiece.links) !== JSON.stringify(newPiece.links)
        };
        
        changes.hasChanges = changes.composerChanged || changes.durationChanged || 
                           changes.infoChanged || changes.linksChanged;
        
        return changes;
    },
    
    /**
     * Génère un rapport de changements lisible
     */
    generateChangeReport: function(changes) {
        const report = [];
        
        // Concerts ajoutés
        if (changes.concerts.added.length > 0) {
            report.push("📋 **NOUVEAUX CONCERTS:**");
            changes.concerts.added.forEach(concert => {
                report.push(`  + ${concert.title} ${concert.duration ? `(${concert.duration})` : ''}`);
            });
            report.push("");
        }
        
        // Concerts supprimés
        if (changes.concerts.removed.length > 0) {
            report.push("🗑️ **CONCERTS SUPPRIMÉS:**");
            changes.concerts.removed.forEach(concert => {
                report.push(`  - ${concert.title}`);
            });
            report.push("");
        }
        
        // Pièces ajoutées
        if (changes.pieces.added.length > 0) {
            report.push("🎵 **NOUVELLES PIÈCES:**");
            changes.pieces.added.forEach(piece => {
                report.push(`  + "${piece.title}" par ${piece.composer || 'compositeur inconnu'} dans "${piece.concertTitle}"`);
            });
            report.push("");
        }
        
        // Pièces supprimées
        if (changes.pieces.removed.length > 0) {
            report.push("❌ **PIÈCES SUPPRIMÉES:**");
            changes.pieces.removed.forEach(piece => {
                report.push(`  - "${piece.title}" de "${piece.concertTitle}"`);
            });
            report.push("");
        }
        
        // Pièces modifiées
        if (changes.pieces.modified.length > 0) {
            report.push("✏️ **PIÈCES MODIFIÉES:**");
            changes.pieces.modified.forEach(piece => {
                report.push(`  ~ "${piece.title}" dans "${piece.concertTitle}"`);
                const c = piece.changes;
                if (c.composerChanged) report.push(`    - Compositeur modifié`);
                if (c.durationChanged) report.push(`    - Durée modifiée`);
                if (c.infoChanged) report.push(`    - Informations modifiées`);
                if (c.linksChanged) report.push(`    - Liens modifiés`);
            });
            report.push("");
        }
        
        if (report.length === 0) {
            report.push("✅ **AUCUN CHANGEMENT DÉTECTÉ**");
        }
        
        return report.join("\n");
    }
};

console.log("📊 Données de référence chargées - Version", window.BASELINE_DATA.metadata.version);
